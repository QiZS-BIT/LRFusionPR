# LRFusionPR
The official implementation for our paper LRFusionPR [[arxiv]](https://arxiv.org/abs/2504.19186).

**LRFusionPR: A Polar BEV-Based LiDAR-Radar Fusion Network for Place Recognition**

[Zhangshuo Qi](https://github.com/QiZS-BIT), [Luqi Cheng](https://github.com/ChengLuqi), [Zijie Zhou](https://github.com/ZhouZijie77), [Guangming Xiong*](https://ieeexplore.ieee.org/author/37286205000)

![image](https://github.com/QiZS-BIT/LRFusionPR/blob/main/assets/motivation.png)

LRFusionPR improves recognition accuracy and robustness by fusing LiDAR with either single-chip or scanning radar.
Extensive evaluations on multiple datasets demonstrate that our LRFusionPR achieves accurate place recognition, while 
maintaining robustness under varying weather conditions.

## Installation
* Ubuntu 20.04 + Python 3.8
* CUDA 11.3 + Pytorch 1.12.0
```
git clone https://github.com/QiZS-BIT/LRFusionPR.git
cd LRFusionPR
conda create -n lrfusionpr python=3.8
conda activate lrfusionpr
pip install -r requirements.txt
```

## Data Preparation
### nuScenes
* Download the official [nuScenes dataset](https://www.nuscenes.org/nuscenes).
* Download the [training indexes of nuScenes-BostonSeaport](https://drive.google.com/drive/folders/15PHPzwaj3_qNSJHcrVV6brslWH7dOTLJ?usp=sharing) generated by AutoPlace.
* Generate the infos, indexes and polar BEVs needed to run the code.
```
cd dataset/NuScenes
python gen_info.py
python gen_index.py
python gen_bev.py
```
* The final data structure should be like:
```
data
├── bs_bev
├── bs_db.npy
├── bs_test_query.npy
├── bs_train_query.npy
├── bs_val_query.npy
├── nuscenes_infos-bs.pkl
├── nuscenes_infos-son.pkl
├── nuscenes_infos-sq.pkl
├── son_bev
├── son_db.npy
├── son_test_query.npy
├── son_whole.npy
├── sq_bev
├── sq_db.npy
├── sq_test_query.npy
└── sq_whole.npy
```
* To generate data for simulated foggy conditions, you need to run the 
following script provided by SeeingThroughFog:
```
cd dataset/NuScenes
python fog_model/lidar_foggification.py
python gen_bev_fog.py
```

### MulRan
* Download the official [MulRan dataset](https://sites.google.com/view/mulran-pr/dataset).
* Generate the infos, indexes and polar BEVs needed to run the code.
```
cd dataset/MulRan
python gen_info.py
python gen_index.py
python gen_bev.py
```
* The final data structure should be like:
```
data
├── oxford_infos-2019-01-11-13-24-51.pkl
├── oxford_infos-2019-01-11-13-24-51_whole.npy
├── oxford_infos-2019-01-11-13-24-51_db.npy
├── oxford_infos-2019-01-11-13-24-51_test_query.npy
└── oxford_infos-01-11-13-24-51_bev
```
* To generate data for simulated foggy conditions, you need to run the 
following script provided by SeeingThroughFog:
```
cd dataset/MulRan
python fog_model/lidar_foggification.py
python gen_bev_fog.py
```

### Oxford Radar Robotcar
* Download the official [Oxford Radar RobotCar dataset](https://oxford-robotics-institute.github.io/radar-robotcar-dataset/downloads).
* Generate the infos, indexes and polar BEVs needed to run the code.
```
cd dataset/OxfordRadar
python gen_info.py
python gen_index.py
python gen_bev.py
```
* The final data structure should be like:
```
data
├── bs_bev
├── bs_db.npy
├── bs_test_query.npy
├── bs_train_query.npy
├── dcc_multi_bev
├── dcc_test_db.npy
├── dcc_test_query.npy
├── dcc_whole.npy
├── mulran_infos-dcc.pkl
├── mulran_infos-riverside.pkl
├── mulran_infos-sejong.pkl
├── nuscenes_infos-bs.pkl
├── nuscenes_infos-son.pkl
├── nuscenes_infos-sq.pkl
├── riverside_multi_bev
├── riverside_test_db.npy
├── riverside_test_query.npy
├── riverside_whole.npy
├── sejong_db.npy
├── sejong_multi_bev
├── sejong_test_db.npy
├── sejong_test_query.npy
├── sejong_train_query.npy
├── sejong_whole.npy
├── son_bev
├── son_db.npy
├── son_test_query.npy
├── son_whole.npy
├── sq_bev
├── sq_db.npy
├── sq_test_query.npy
└── sq_whole.npy
```

## TODO
- [X] Release the [paper](https://arxiv.org/abs/2504.19186)
- [X] Release the data preparation code
- [ ] Release the training and evaluation code, and our pretrained model

## Acknowledgement
Many thanks to these excellent projects:
* [LCPR](https://github.com/ZhouZijie77/LCPR)
* [AutoPlace](https://github.com/ramdrop/autoplace)
* [EgoNN](https://github.com/jac99/Egonn)
* [SeeingThroughFog](https://github.com/princeton-computational-imaging/SeeingThroughFog)
